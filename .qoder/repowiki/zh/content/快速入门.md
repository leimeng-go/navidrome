# 快速入门

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [main.go](file://main.go)
- [conf/configuration.go](file://conf/configuration.go)
- [cmd/root.go](file://cmd/root.go)
- [Dockerfile](file://Dockerfile)
- [server/initial_setup.go](file://server/initial_setup.go)
- [server/server.go](file://server/server.go)
- [contrib/docker-compose/docker-compose-caddy.yml](file://contrib/docker-compose/docker-compose-caddy.yml)
- [contrib/docker-compose/docker-compose-traefik.yml](file://contrib/docker-compose/docker-compose-traefik.yml)
- [release/linux/navidrome.toml](file://release/linux/navidrome.toml)
</cite>

## 目录
1. [简介](#简介)
2. [安装方法](#安装方法)
   - [Docker部署](#docker部署)
   - [二进制文件运行](#二进制文件运行)
3. [配置与环境变量](#配置与环境变量)
   - [配置文件](#配置文件)
   - [环境变量](#环境变量)
4. [初始设置](#初始设置)
   - [创建管理员账户](#创建管理员账户)
   - [配置音乐库路径](#配置音乐库路径)
5. [启动与使用](#启动与使用)
   - [启动服务](#启动服务)
   - [访问Web界面](#访问web界面)
   - [播放第一首歌曲](#播放第一首歌曲)
6. [常见问题与解决方案](#常见问题与解决方案)
   - [端口冲突](#端口冲突)
   - [权限错误](#权限错误)
7. [附录](#附录)

## 简介

Navidrome是一个开源的基于Web的音乐收藏服务器和流媒体服务。它允许您从任何浏览器或移动设备上收听您的音乐收藏，就像您自己的Spotify一样。本指南将详细介绍如何快速安装和配置Navidrome，包括Docker部署和二进制文件运行两种方式。

**Section sources**
- [README.md](file://README.md#L1-L89)

## 安装方法

### Docker部署

使用Docker是部署Navidrome最简单的方法。Navidrome提供了官方的Docker镜像，可以通过以下命令快速启动：

```bash
docker run -d \
  --name navidrome \
  --restart=unless-stopped \
  -p 4533:4533 \
  -v /path/to/your/music:/music:ro \
  -v /path/to/your/data:/data \
  deluan/navidrome:latest
```

您也可以使用提供的docker-compose文件来部署，例如使用Caddy作为反向代理：

```yaml
version: '3.6'

volumes:
  caddy_data:
  navidrome_data:

services:
  caddy:
    container_name: "caddy"
    image: caddy:2.6-alpine
    restart: unless-stopped
    read_only: true
    volumes:
      - "caddy_data:/data:rw"
      - "./Caddyfile:/etc/caddy/Caddyfile:ro"
    ports:
      - "80:80"
      - "443:443"

  navidrome:
    container_name: "navidrome"
    image: deluan/navidrome:latest
    restart: unless-stopped
    read_only: true
    ports:
      - "4533:4533"
    volumes:
      - "navidrome_data:/data"
      #- "/mnt/music:/music:ro"
```

**Section sources**
- [Dockerfile](file://Dockerfile#L1-L147)
- [contrib/docker-compose/docker-compose-caddy.yml](file://contrib/docker-compose/docker-compose-caddy.yml#L1-L32)
- [contrib/docker-compose/docker-compose-traefik.yml](file://contrib/docker-compose/docker-compose-traefik.yml#L1-L52)

### 二进制文件运行

对于不使用Docker的用户，Navidrome提供了适用于所有主要平台的预编译二进制文件，包括Raspberry Pi。您可以从[GitHub发布页面](https://github.com/navidrome/navidrome/releases)下载适合您系统的二进制文件。

下载后，直接运行二进制文件即可启动Navidrome：

```bash
./navidrome
```

默认情况下，Navidrome会在当前目录下查找名为`navidrome.toml`的配置文件，并将数据存储在当前目录中。

**Section sources**
- [README.md](file://README.md#L32-L34)
- [main.go](file://main.go#L1-L20)

## 配置与环境变量

### 配置文件

Navidrome支持多种配置文件格式，包括TOML、JSON、YAML和INI。配置文件的默认名称是`navidrome.toml`，位于当前目录或通过`--configfile`参数指定的路径。

以下是一个基本的配置文件示例：

```toml
DataFolder = "/var/lib/navidrome"
MusicFolder = "/opt/navidrome/music"
```

配置文件中的选项会覆盖命令行参数和环境变量的值。

**Section sources**
- [conf/configuration.go](file://conf/configuration.go#L22-L137)
- [release/linux/navidrome.toml](file://release/linux/navidrome.toml#L1-L3)

### 环境变量

Navidrome的所有配置选项都可以通过环境变量进行设置。环境变量的命名规则是将配置选项的名称转换为大写，并将点（.）替换为下划线（_），前缀为`ND_`。

例如，`MusicFolder`配置选项对应的环境变量是`ND_MUSICFOLDER`。

以下是一些常用的环境变量：

- `ND_MUSICFOLDER`: 音乐文件夹路径
- `ND_DATAFOLDER`: 数据文件夹路径
- `ND_PORT`: 服务监听端口
- `ND_LOGLEVEL`: 日志级别（error, info, debug, trace）

**Section sources**
- [conf/configuration.go](file://conf/configuration.go#L667-L719)
- [ui/src/dialogs/aboutUtils.js](file://ui/src/dialogs/aboutUtils.js#L1-L42)

## 初始设置

### 创建管理员账户

首次启动Navidrome时，系统会自动创建一个初始管理员账户。您可以通过Web界面的初始设置向导来创建这个账户。

如果使用开发模式，可以通过设置`DevAutoCreateAdminPassword`环境变量来自动创建管理员账户：

```bash
ND_DEV_AUTOCREATEADMINPASSWORD=mypassword ./navidrome
```

这将在启动时自动创建一个用户名为`admin`，密码为指定值的管理员账户。

**Section sources**
- [server/initial_setup.go](file://server/initial_setup.go#L17-L66)
- [conf/configuration.go](file://conf/configuration.go#L113-L114)

### 配置音乐库路径

音乐库路径可以通过以下三种方式配置：

1. **配置文件**: 在`navidrome.toml`中设置`MusicFolder`选项
2. **命令行参数**: 使用`--musicfolder`参数
3. **环境变量**: 设置`ND_MUSICFOLDER`环境变量

例如：

```bash
./navidrome --musicfolder /path/to/your/music
```

或

```bash
ND_MUSICFOLDER=/path/to/your/music ./navidrome
```

**Section sources**
- [conf/configuration.go](file://conf/configuration.go#L27-L28)
- [cmd/root.go](file://cmd/root.go#L354-L355)

## 启动与使用

### 启动服务

启动Navidrome服务非常简单。根据您的安装方式，执行相应的命令：

**Docker方式**:
```bash
docker start navidrome
```

**二进制文件方式**:
```bash
./navidrome
```

服务启动后，默认会在`0.0.0.0:4533`监听HTTP请求。

**Section sources**
- [main.go](file://main.go#L11-L20)
- [cmd/root.go](file://cmd/root.go#L49-L58)

### 访问Web界面

服务启动后，您可以通过浏览器访问`http://localhost:4533`来打开Navidrome的Web界面。

首次访问时，系统会引导您完成初始设置，包括创建管理员账户和配置音乐库路径。

**Section sources**
- [server/server.go](file://server/server.go#L226-L235)
- [server/server.go](file://server/server.go#L62-L145)

### 播放第一首歌曲

1. 登录到Web界面
2. 系统会自动开始扫描您配置的音乐库
3. 扫描完成后，您可以在"音乐"部分浏览您的音乐收藏
4. 点击任意歌曲即可开始播放

Navidrome支持几乎所有常见的音频格式，并会自动读取和使用您的音乐文件中的元数据。

**Section sources**
- [server/initial_setup.go](file://server/initial_setup.go#L176-L219)
- [scanner/controller.go](file://scanner/controller.go)

## 常见问题与解决方案

### 端口冲突

如果4533端口已被其他程序占用，您可以通过以下方式更改Navidrome的监听端口：

**配置文件方式**:
```toml
Port = 4534
```

**命令行参数方式**:
```bash
./navidrome --port 4534
```

**环境变量方式**:
```bash
ND_PORT=4534 ./navidrome
```

**Section sources**
- [conf/configuration.go](file://conf/configuration.go#L25-L26)
- [cmd/root.go](file://cmd/root.go#L367-L368)

### 权限错误

当Navidrome无法访问音乐文件或数据目录时，可能会出现权限错误。请确保：

1. Navidrome进程有权限读取音乐目录
2. Navidrome进程有权限读写数据目录
3. 如果使用Docker，请确保卷挂载的权限设置正确

在Docker中，可以通过设置容器用户来解决权限问题：

```yaml
navidrome:
  image: deluan/navidrome:latest
  user: 1000:1000
  volumes:
    - "navidrome_data:/data"
    - "/mnt/music:/music:ro"
```

**Section sources**
- [server/server.go](file://server/server.go#L85-L97)
- [contrib/docker-compose/docker-compose-caddy.yml](file://contrib/docker-compose/docker-compose-caddy.yml#L26-L27)

## 附录

本快速入门指南涵盖了Navidrome的基本安装和配置。更多详细信息，请参考[官方文档](https://www.navidrome.org/docs)。

**Section sources**
- [README.md](file://README.md#L69-L80)