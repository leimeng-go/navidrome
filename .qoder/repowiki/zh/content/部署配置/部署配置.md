# 部署配置

<cite>
**本文档中引用的文件**  
- [Dockerfile](file://Dockerfile)
- [contrib/docker-compose/docker-compose-caddy.yml](file://contrib/docker-compose/docker-compose-caddy.yml)
- [contrib/docker-compose/docker-compose-traefik.yml](file://contrib/docker-compose/docker-compose-traefik.yml)
- [contrib/docker-compose/Caddyfile](file://contrib/docker-compose/Caddyfile)
- [contrib/k8s/manifest.yml](file://contrib/k8s/manifest.yml)
- [contrib/k8s/README.md](file://contrib/k8s/README.md)
- [contrib/navidrome.service](file://contrib/navidrome.service)
- [contrib/freebsd_rc](file://contrib/freebsd_rc)
- [release/linux/navidrome.toml](file://release/linux/navidrome.toml)
- [conf/configuration.go](file://conf/configuration.go)
- [conf/testdata/cfg.toml](file://conf/testdata/cfg.toml)
- [tests/navidrome-test.toml](file://tests/navidrome-test.toml)
- [cmd/backup.go](file://cmd/backup.go)
- [db/backup.go](file://db/backup.go)
- [core/metrics/prometheus.go](file://core/metrics/prometheus.go)
</cite>

## 目录
1. [简介](#简介)
2. [Docker部署](#docker部署)
3. [Kubernetes部署](#kubernetes部署)
4. [系统服务部署](#系统服务部署)
5. [配置文件详解](#配置文件详解)
6. [性能调优建议](#性能调优建议)
7. [备份与恢复策略](#备份与恢复策略)
8. [监控与日志配置](#监控与日志配置)
9. [高可用性部署方案](#高可用性部署方案)
10. [最佳实践](#最佳实践)

## 简介
Navidrome是一款音乐服务器和流媒体服务，兼容Subsonic/Airsonic客户端。本文档详细说明了Navidrome的各种部署方式，包括Docker、Kubernetes和系统服务。文档提供了每种部署方式的配置文件示例和最佳实践，解释了不同部署环境下的性能调优建议，描述了备份和恢复策略，提供了监控和日志配置指南，并为系统管理员提供了高可用性部署方案。

**Section sources**
- [Dockerfile](file://Dockerfile)
- [contrib/docker-compose/docker-compose-caddy.yml](file://contrib/docker-compose/docker-compose-caddy.yml)
- [contrib/k8s/manifest.yml](file://contrib/k8s/manifest.yml)
- [contrib/navidrome.service](file://contrib/navidrome.service)

## Docker部署
Navidrome提供了官方的Docker镜像，支持多种部署方式。Docker部署是最简单和最常用的部署方式，适用于大多数使用场景。

### 基本Docker部署
使用Docker部署Navidrome非常简单，只需运行以下命令：

```bash
docker run -d \
  --name navidrome \
  --restart=unless-stopped \
  -p 4533:4533 \
  -v /path/to/your/music:/music:ro \
  -v /path/to/datafolder:/data \
  deluan/navidrome:latest
```

此命令将Navidrome作为后台服务运行，映射端口4533，并将音乐文件夹和数据文件夹挂载到容器中。

### 使用Caddy反向代理
Navidrome提供了使用Caddy作为反向代理的Docker Compose配置文件。Caddy是一个现代化的Web服务器，支持自动HTTPS。

```yaml
version: '3.6'

volumes:
  caddy_data:
  navidrome_data:

services:
  caddy:
    container_name: "caddy"
    image: caddy:2.6-alpine
    restart: unless-stopped
    read_only: true
    volumes:
      - "caddy_data:/data:rw"
      - "./Caddyfile:/etc/caddy/Caddyfile:ro"
    ports:
      - "80:80"
      - "443:443"

  navidrome:
    container_name: "navidrome"
    image: deluan/navidrome:latest
    restart: unless-stopped
    read_only: true
    ports:
      - "4533:4533"
    volumes:
      - "navidrome_data:/data"
      - "/mnt/music:/music:ro"
```

Caddyfile配置文件定义了反向代理规则：

```text
https://your.website {
  reverse_proxy * navidrome:4533 {
    header_up Host {http.reverse_proxy.upstream.hostport}
    header_up X-Forwarded-For {http.request.remote}
    header_up X-Real-IP {http.reverse_proxy.upstream.port}
  }
}
```

### 使用Traefik反向代理
Navidrome也提供了使用Traefik作为反向代理的Docker Compose配置文件。Traefik是一个现代化的反向代理和负载均衡器。

```yaml
version: "3.6"

volumes:
  traefik_data:
  navidrome_data:

services:
  traefik:
    container_name: "traefik"
    image: traefik:2.9
    restart: unless-stopped
    read_only: true
    command:
      - "--log.level=ERROR"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.websecure.address=:443"
      - "--certificatesresolvers.tc.acme.tlschallenge=true"
      - "--certificatesresolvers.tc.acme.email=foo@foo.com"
      - "--certificatesresolvers.tc.acme.storage=/letsencrypt/acme.json"
    ports:
      - "443:443"
    volumes:
      - "traefik_data:/letsencrypt"

  navidrome:
    container_name: "navidrome"
    image: deluan/navidrome:latest
    restart: unless-stopped
    read_only: true
    ports:
      - "4533:4533"
    environment:
      ND_SCANINTERVAL: 6h
      ND_LOGLEVEL: info
      ND_SESSIONTIMEOUT: 168h
      ND_BASEURL: ""
    volumes:
      - "navidrome_data:/data"
      - "/mnt/music:/music:ro"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.navidrome.rule=Host(`foo.com`)"
      - "traefik.http.routers.navidrome.entrypoints=websecure"
      - "traefik.http.routers.navidrome.tls=true"
      - "traefik.http.routers.navidrome.tls.certresolver=tc"
      - "traefik.http.services.navidrome.loadbalancer.server.port=4533"
```

**Section sources**
- [contrib/docker-compose/docker-compose-caddy.yml](file://contrib/docker-compose/docker-compose-caddy.yml)
- [contrib/docker-compose/docker-compose-traefik.yml](file://contrib/docker-compose/docker-compose-traefik.yml)
- [contrib/docker-compose/Caddyfile](file://contrib/docker-compose/Caddyfile)
- [Dockerfile](file://Dockerfile)

## Kubernetes部署
Navidrome提供了Kubernetes部署的示例清单文件，适用于在Kubernetes集群中部署Navidrome。

### Kubernetes部署清单
Navidrome的Kubernetes部署清单文件定义了命名空间、持久卷声明、部署、服务和入口资源。

```yaml
---
apiVersion: v1
kind: Namespace
metadata:
  name: navidrome
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: navidrome-data-pvc
  namespace: navidrome
  annotations:
    volumeType: local
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  storageClassName: local-path
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: navidrome-deployment
  namespace: navidrome
spec:
  replicas: 1
  revisionHistoryLimit: 2
  selector:
    matchLabels:
      app: navidrome
  template:
    metadata:
      labels:
        app: navidrome
    spec:
      containers:
        - name: navidrome
          image: ghcr.io/navidrome/navidrome:0.49.3
          ports:
            - containerPort: 4533
          env:
            - name: ND_SCANSCHEDULE
              value: "12h"
            - name: ND_SESSIONTIMEOUT
              value: "24h"
            - name: ND_LOGLEVEL
              value: "info"
            - name: ND_ENABLETRANSCODINGCONFIG
              value: "false"
            - name: ND_TRANSCODINGCACHESIZE
              value: "512MB"
            - name: ND_ENABLESTARRATING
              value: "false"
            - name: ND_ENABLEFAVOURITES
              value: "false"
          volumeMounts:
            - name: data
              mountPath: /data
            - name: music
              mountPath: /music
              readOnly: true
      volumes:
        - name: data
          persistentVolumeClaim:
            claimName: navidrome-data-pvc
        - name: music
          hostPath:
            path: /path/to/your/music/on/the/host
            type: Directory
---
apiVersion: v1
kind: Service
metadata:
  name: navidrome-service
  namespace: navidrome
spec:
  type: ClusterIP
  ports:
    - name: http
      targetPort: 4533
      port: 4533
      protocol: TCP
  selector:
    app: navidrome
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: navidrome-ingress
  namespace: navidrome
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-production
    traefik.ingress.kubernetes.io/router.tls: "true"
spec:
  rules:
    - host: navidrome.${SECRET_INTERNAL_DOMAIN_NAME}
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: navidrome-service
                port:
                  number: 4533
  tls:
    - hosts:
        - navidrome.${SECRET_INTERNAL_DOMAIN_NAME}
      secretName: navidrome-tls
```

### Kubernetes部署注意事项
根据contrib/k8s/README.md文件，部署Navidrome时需要注意以下几点：

1. 此清单创建了一个名为`navidrome`的命名空间，可根据需要进行调整。
2. 此清单是在K3s上创建的，使用了local-path-provisioner作为存储提供程序。请根据需要更改PersistentVolumeClaim的storageClassName。
3. PersistentVolumeClaim为Navidrome的数据库设置了2Gi的卷，可根据需要进行调整。
4. 请将image标签从`ghcr.io/navidrome/navidrome:0.49.3`更改为最新版本。
5. 此清单假设您的音乐文件通过hostPath挂载在主机上，位于`/path/to/your/music/on/the/host`，请根据需要进行调整。
6. Ingress已配置为使用cert-manager获取Let's Encrypt TLS证书，并使用Traefik进行路由。请根据需要进行调整。
7. Ingress在`navidrome.${SECRET_INTERNAL_DOMAIN_NAME}`上提供服务，需要已在DNS中设置。

**Section sources**
- [contrib/k8s/manifest.yml](file://contrib/k8s/manifest.yml)
- [contrib/k8s/README.md](file://contrib/k8s/README.md)

## 系统服务部署
Navidrome提供了系统服务部署的配置文件，适用于在Linux和FreeBSD系统上作为系统服务运行。

### Linux系统服务
Navidrome提供了systemd服务文件，用于在Linux系统上作为系统服务运行。

```text
# This file ususaly goes in /etc/systemd/system

[Unit]
Description=Navidrome Music Server and Streamer compatible with Subsonic/Airsonic
After=remote-fs.target network.target

[Install]
WantedBy=multi-user.target

[Service]
User=navidrome
Group=navidrome
Type=simple
ExecStart=/usr/bin/navidrome --configfile "/etc/navidrome/navidrome.toml"
StateDirectory=navidrome
WorkingDirectory=/var/lib/navidrome
TimeoutStopSec=20
KillMode=process
Restart=on-failure

# See https://www.freedesktop.org/software/systemd/man/systemd.exec.html
CapabilityBoundingSet=
DevicePolicy=closed
NoNewPrivileges=yes
LockPersonality=yes
PrivateTmp=yes
PrivateUsers=yes
ProtectControlGroups=yes
ProtectKernelModules=yes
ProtectKernelTunables=yes
ProtectClock=yes
ProtectHostname=yes
ProtectKernelLogs=yes
RestrictAddressFamilies=AF_UNIX AF_INET AF_INET6
RestrictNamespaces=yes
RestrictRealtime=yes
SystemCallFilter=@system-service
SystemCallFilter=~@privileged @resources
SystemCallFilter=setrlimit
SystemCallArchitectures=native
UMask=0066

# You can uncomment the following line if you're not using the jukebox This
# will prevent navidrome from accessing any real (physical) devices
#PrivateDevices=yes

# You can change the following line to `strict` instead of `full` if you don't
# want navidrome to be able to write anything on your filesystem outside of
# /var/lib/navidrome.
ProtectSystem=full

# You can comment the following line if you don't have any media in /home/*.
# This will prevent navidrome from ever reading/writing anything there.
ProtectHome=true
```

### FreeBSD系统服务
Navidrome还提供了FreeBSD的rc脚本，用于在FreeBSD系统上作为系统服务运行。

```text
#!/bin/sh
#
# $FreeBSD: $
#
# PROVIDE: navidrome
# REQUIRE: NETWORKING
# KEYWORD:
#
# Add the following lines to /etc/rc.conf to enable navidrome:
# navidrome_enable="YES"
#
# navidrome_enable (bool):              Set to YES to enable navidrome
#                                       Default: NO
# navidrome_config (str):               navidrome configuration file
#                                       Default: /usr/local/etc/navidrome/config.toml
# navidrome_datafolder (str):   navidrome Folder to store application data 
#                                       Default: www
# navidrome_user (str):         navidrome daemon user
#                                       Default: www
# navidrome_group (str):                navidrome daemon group
#                                       Default: www

. /etc/rc.subr

name="navidrome"
rcvar="navidrome_enable"
load_rc_config $name

: ${navidrome_user:="www"}
: ${navidrome_group:="www"}
: ${navidrome_enable:="NO"}
: ${navidrome_config:="/usr/local/etc/navidrome/config.toml"}
: ${navidrome_flags=""}
: ${navidrome_facility:="daemon"}
: ${navidrome_priority:="debug"}
: ${navidrome_datafolder:="/var/db/${name}"}

required_dirs=${navidrome_datafolder}
required_files=${navidrome_config}
procname="/usr/local/bin/${name}"
pidfile="/var/run/${name}.pid"
start_precmd="${name}_precmd"
command=/usr/sbin/daemon
command_args="-S -l ${navidrome_facility} -s ${navidrome_priority} -T ${name} -t ${name} -p ${pidfile} \
        ${procname} --configfile ${navidrome_config} --datafolder ${navidrome_datafolder} ${navidrome_flags}"

navidrome_precmd()
{
        install -o ${navidrome_user} /dev/null ${pidfile}
}

run_rc_command "$1"
```

**Section sources**
- [contrib/navidrome.service](file://contrib/navidrome.service)
- [contrib/freebsd_rc](file://contrib/freebsd_rc)

## 配置文件详解
Navidrome支持多种配置文件格式，包括TOML、JSON、YAML和INI。配置文件可以与环境变量结合使用，环境变量的优先级高于配置文件。

### 配置文件格式
Navidrome支持以下配置文件格式：
- TOML (推荐)
- JSON
- YAML
- INI

配置文件的默认名称为`navidrome.toml`，可以通过`--configfile`命令行参数或`ND_CONFIGFILE`环境变量指定其他配置文件。

### 主要配置选项
Navidrome的配置选项分为多个类别，包括基本设置、扫描设置、用户界面设置、外部服务设置等。

#### 基本设置
```toml
# 基本设置
DataFolder = "/var/lib/navidrome"
MusicFolder = "/opt/navidrome/music"
Address = "0.0.0.0"
Port = 4533
LogLevel = "info"
SessionTimeout = "168h"
BaseURL = ""
```

#### 扫描设置
```toml
[Scanner]
Enabled = true
Schedule = "0"
WatcherWait = "2s"
ScanOnStartup = true
Extractor = "taglib"
ArtistJoiner = " / "
FollowSymlinks = true
PurgeMissing = "never"
```

#### 用户界面设置
```toml
UILoginBackgroundURL = "https://source.unsplash.com/random/?music"
UIWelcomeMessage = ""
MaxSidebarPlaylists = 10
DefaultTheme = "Dark"
DefaultLanguage = ""
DefaultUIVolume = 50
```

#### 外部服务设置
```toml
[LastFM]
Enabled = true
ApiKey = ""
Secret = ""
Language = "en"

[Spotify]
ID = ""
Secret = ""

[Deezer]
Enabled = true
Language = "en"
```

#### 插件设置
```toml
[Plugins]
Enabled = false
Folder = ""
CacheSize = "100MB"
```

#### 备份设置
```toml
[Backup]
Count = 0
Path = ""
Schedule = ""
```

### 环境变量
Navidrome的所有配置选项都可以通过环境变量设置。环境变量的名称以`ND_`开头，配置选项名称中的点(.)替换为下划线(_)。例如，`ND_MUSICFOLDER`对应`MusicFolder`，`ND_SCANNER_SCHEDULE`对应`Scanner.Schedule`。

**Section sources**
- [conf/configuration.go](file://conf/configuration.go)
- [release/linux/navidrome.toml](file://release/linux/navidrome.toml)
- [conf/testdata/cfg.toml](file://conf/testdata/cfg.toml)
- [tests/navidrome-test.toml](file://tests/navidrome-test.toml)

## 性能调优建议
为了确保Navidrome在不同部署环境下的最佳性能，建议根据具体使用场景进行性能调优。

### 扫描性能调优
Navidrome的扫描性能受多个因素影响，包括音乐库大小、文件系统类型和硬件性能。

#### 扫描调度
通过`Scanner.Schedule`配置选项或`ND_SCANNER_SCHEDULE`环境变量设置扫描调度。可以使用cron表达式或持续时间格式。例如，`"0 2 * * *"`表示每天凌晨2点扫描，`"12h"`表示每12小时扫描一次。

#### 扫描线程
通过`DevScannerThreads`配置选项或`ND_DEVSCANNERTHREADS`环境变量设置扫描线程数。默认值为5，可以根据CPU核心数进行调整。

#### 扫描提取器
Navidrome使用taglib作为元数据提取器。确保taglib库已正确安装和配置。

### 缓存性能调优
Navidrome使用多种缓存机制来提高性能，包括转码缓存和图像缓存。

#### 转码缓存
通过`TranscodingCacheSize`配置选项或`ND_TRANSCODINGCACHESIZE`环境变量设置转码缓存大小。默认值为"100MB"，可以根据内存大小和使用场景进行调整。

#### 图像缓存
通过`ImageCacheSize`配置选项或`ND_IMAGECACHESIZE`环境变量设置图像缓存大小。默认值为"100MB"，可以根据内存大小和使用场景进行调整。

### 数据库性能调优
Navidrome使用SQLite作为数据库。对于大型音乐库，建议优化数据库性能。

#### 数据库优化
通过`DevOptimizeDB`配置选项或`ND_DEVOPTIMIZEDB`环境变量启用数据库优化。默认值为true。

#### 数据库路径
通过`DbPath`配置选项或`ND_DBPATH`环境变量设置数据库路径。建议将数据库文件放在SSD上以提高性能。

### 网络性能调优
Navidrome的网络性能受多个因素影响，包括网络带宽、延迟和客户端类型。

#### 转码设置
通过`DefaultDownsamplingFormat`配置选项或`ND_DEFAULTDOWNSAMPLINGFORMAT`环境变量设置默认降采样格式。可以根据网络带宽选择合适的格式。

#### 并发连接
通过`Inspect.MaxRequests`、`Inspect.BacklogLimit`和`Inspect.BacklogTimeout`配置选项或相应的环境变量设置并发连接限制。可以根据服务器性能和网络带宽进行调整。

**Section sources**
- [conf/configuration.go](file://conf/configuration.go)
- [core/metrics/prometheus.go](file://core/metrics/prometheus.go)

## 备份与恢复策略
Navidrome提供了内置的备份和恢复功能，确保数据安全。

### 备份配置
通过`Backup`配置部分设置备份策略：

```toml
[Backup]
# 备份目录路径
Path = "/path/to/backup/directory"

# 备份保留数量
Count = 7

# 备份调度（cron表达式或持续时间）
Schedule = "0 2 * * *"
```

### 手动备份
可以使用`navidrome backup`命令手动创建备份：

```bash
navidrome backup --configfile "/etc/navidrome/navidrome.toml"
```

### 自动备份
通过`Backup.Schedule`配置选项设置自动备份调度。Navidrome会根据调度自动创建备份。

### 备份清理
通过`Backup.Count`配置选项设置保留的备份数量。Navidrome会自动清理超过保留数量的旧备份。

### 恢复备份
可以使用`navidrome restore`命令恢复备份：

```bash
navidrome restore --configfile "/etc/navidrome/navidrome.toml" /path/to/backup/file
```

### 备份文件命名
Navidrome的备份文件按以下格式命名：
`navidrome-backup-{timestamp}.db`

其中`{timestamp}`是备份创建时间的ISO 8601格式。

**Section sources**
- [cmd/backup.go](file://cmd/backup.go)
- [db/backup.go](file://db/backup.go)

## 监控与日志配置
Navidrome提供了详细的监控和日志功能，帮助系统管理员了解系统状态和排查问题。

### 日志配置
Navidrome的日志配置包括日志级别、日志文件和日志红acting。

#### 日志级别
通过`LogLevel`配置选项或`ND_LOGLEVEL`环境变量设置日志级别。支持的级别包括：
- `error`
- `warn`
- `info` (默认)
- `debug`

#### 日志文件
通过`LogFile`配置选项或`ND_LOGFILE`环境变量设置日志文件路径。如果未设置，日志将输出到标准错误。

#### 日志红acting
通过`EnableLogRedacting`配置选项或`ND_ENABLELOGREDACTING`环境变量启用日志红acting。默认值为true，敏感信息将被红acted。

### Prometheus监控
Navidrome内置了Prometheus监控支持，可以收集和暴露各种指标。

#### 启用Prometheus
通过`Prometheus.Enabled`配置选项或`ND_PROMETHEUS_ENABLED`环境变量启用Prometheus监控。

```toml
[Prometheus]
Enabled = true
MetricsPath = "/metrics"
Password = "your_password"
```

#### 监控指标
Navidrome暴露以下Prometheus指标：
- `db_model_totals`: 数据库中各模型的总数
- `navidrome_info`: Navidrome版本信息
- `media_scan_last`: 最后一次媒体扫描时间戳
- `media_scans`: 媒体扫描总数
- `http_request_count`: HTTP请求计数
- `http_request_latency`: HTTP请求延迟
- `plugin_request_count`: 插件请求计数
- `plugin_request_latency`: 插件请求延迟

#### 认证
通过`Prometheus.Password`配置选项或`ND_PROMETHEUS_PASSWORD`环境变量设置Prometheus端点的密码。用户名为`navidrome`。

### 其他监控端点
Navidrome还提供了其他监控端点：

#### 健康检查
`/keepalive`端点可用于健康检查。

#### 配置查看
`/config`端点可用于查看当前配置（需要管理员权限）。

#### 扫描状态
`/insights`端点可用于查看扫描状态。

**Section sources**
- [core/metrics/prometheus.go](file://core/metrics/prometheus.go)
- [conf/configuration.go](file://conf/configuration.go)
- [server/nativeapi/config.go](file://server/nativeapi/config.go)

## 高可用性部署方案
为了实现Navidrome的高可用性，建议采用以下部署方案。

### 负载均衡
在多个Navidrome实例前部署负载均衡器，如Nginx、HAProxy或云服务提供的负载均衡器。

#### 负载均衡配置
```nginx
upstream navidrome {
    server navidrome1:4533;
    server navidrome2:4533;
    server navidrome3:4533;
}

server {
    listen 443 ssl;
    server_name music.example.com;

    location / {
        proxy_pass http://navidrome;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 共享存储
使用共享存储系统（如NFS、GlusterFS或云存储）来存储音乐文件和数据库，确保所有Navidrome实例访问相同的数据。

#### NFS配置示例
```bash
# 在NFS服务器上
echo "/music 192.168.1.0/24(rw,sync,no_subtree_check)" >> /etc/exports
exportfs -a

# 在Navidrome实例上
mount -t nfs nfs-server:/music /music
```

### 数据库高可用
对于生产环境，建议使用支持高可用的数据库系统，如PostgreSQL或MySQL，而不是SQLite。

### 会话管理
配置外部会话存储（如Redis）来管理用户会话，确保用户在不同Navidrome实例间切换时会话保持。

### 自动故障转移
使用服务发现和自动故障转移机制（如Consul、etcd或Kubernetes）来检测和处理Navidrome实例的故障。

### 监控和告警
部署全面的监控和告警系统，及时发现和处理问题。

**Section sources**
- [contrib/k8s/manifest.yml](file://contrib/k8s/manifest.yml)
- [contrib/docker-compose/docker-compose-traefik.yml](file://contrib/docker-compose/docker-compose-traefik.yml)

## 最佳实践
遵循以下最佳实践可以确保Navidrome的稳定运行和最佳性能。

### 安全最佳实践
- 使用HTTPS保护Navidrome的Web界面和API
- 配置强密码策略
- 定期更新Navidrome到最新版本
- 限制对Navidrome服务器的网络访问
- 使用防火墙规则限制端口访问

### 性能最佳实践
- 将音乐文件存储在SSD上
- 为Navidrome分配足够的内存
- 定期优化数据库
- 使用适当的缓存大小
- 根据网络带宽选择合适的转码格式

### 备份最佳实践
- 定期备份Navidrome数据
- 将备份存储在不同的物理位置
- 定期测试备份恢复过程
- 监控备份状态

### 监控最佳实践
- 启用Prometheus监控
- 设置适当的告警阈值
- 定期检查日志文件
- 监控系统资源使用情况

### 部署最佳实践
- 使用容器化部署（Docker）
- 使用配置管理工具（如Ansible、Puppet）
- 使用版本控制系统管理配置文件
- 使用CI/CD管道自动化部署

**Section sources**
- [Dockerfile](file://Dockerfile)
- [conf/configuration.go](file://conf/configuration.go)
- [contrib/navidrome.service](file://contrib/navidrome.service)